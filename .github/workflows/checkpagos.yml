name: Verificación de Pagos

on:
  # Ejecución programada a las 16:00 UTC (11:00 Perú)
  schedule:
    - cron: '0 16 * * *'  # 16:00 UTC diario (11:00 AM Perú)
  
  # Permitir ejecución manual
  workflow_dispatch:

jobs:
  verificacion-pagos:
    runs-on: ubuntu-latest
    
    steps:
    - name: 🕐 Debug - Información de ejecución
      run: |
        echo "🔄 === VERIFICACIÓN DE PAGOS ==="
        echo "Event name: ${{ github.event_name }}"
        echo "UTC Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "Peru Time: $(TZ='America/Lima' date '+%Y-%m-%d %H:%M:%S %Z')"
    
    - name: Checkout código
      uses: actions/checkout@v4
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Crear archivo .env
      run: |
        echo "GOOGLE_SERVICE_ACCOUNT_FILE=sistemaasistencia-470019-3f3d35327bca.json" >> .env
        echo "GOOGLE_SHEET_ID=${{ secrets.GOOGLE_SHEET_ID }}" >> .env
    
    - name: Crear archivo de credenciales de Google
      run: |
        echo '${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}' > sistemaasistencia-470019-3f3d35327bca.json
    
    - name: Ejecutar Verificación de Pagos
      run: |
        python checkpagos.py
